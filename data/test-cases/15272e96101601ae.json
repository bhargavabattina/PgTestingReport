{"uid":"15272e96101601ae","name":"eNach With out round off Calculation Testing | Scenario=S24 | Mode=UPI INTENT | Slab=1-1000 | Amount=800","fullName":"testCases.eNach_test.TestCalculations#test_calculation_amount","historyId":"5bd74cb5f6f6e029d8512462f29c6765","time":{"start":1760584041610,"stop":1760584065175,"duration":23565},"status":"failed","statusMessage":"Failed: Payment Aborted message found on screen","statusTrace":"self = <testCases.eNach_test.TestCalculations object at 0x0000021BDD4FA2E0>, page_with_screenshot = <Page url='https://securetest.sabpaisa.in/ClientTest/callBackV1Prod'>\nscenario = 'S24', payment_mode = 'UPI INTENT', slab = '1-1000', amount = 800, excel_client_code = 'DJ050', excel_environment = 'STAGING', ensure_db_updated = None\n\n    @allure.story(\"e-Nach Calculation\")\n    @allure.severity(allure.severity_level.CRITICAL)\n    @pytest.mark.ui\n    @pytest.mark.regression\n    def test_calculation_amount(self, page_with_screenshot, scenario, payment_mode, slab, amount, excel_client_code,\n                                excel_environment, ensure_db_updated):\n        logger = LogGen.loggen(\"Calculation\")\n        \"\"\"Test the cancel transaction button functionality.\"\"\"\n        timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n        allure.dynamic.title(\n            f\"eNach With out round off Calculation Testing | Scenario={scenario} | Mode={payment_mode} | Slab={slab} | Amount={amount}\"\n        )\n        logger.info(f\"--- Starting calculation Test for {scenario} | {payment_mode} | {slab} | {amount} ---\")\n    \n        bill_amount = conv_charges = total_amount = txn_id = \"N/A\"\n        status = \"Fail\"\n    \n        try:\n            if payment_mode == \"UPI INTENT\":\n                viewport_size = {\"width\": 375, \"height\": 667}  # Example: iPhone-like dimensions\n                page_with_screenshot.set_viewport_size(viewport_size)\n                logger.info(\n                    f\"Set viewport size to {viewport_size['width']}x{viewport_size['height']} for UPI INTENT mode\")\n                allure.attach(page_with_screenshot.screenshot(), name=\"UPI Intent Initial Viewport\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n    \n            # Initialize page objects\n            client = ClientPage(page_with_screenshot)\n            client_details = ClientDetailsPage(page_with_screenshot)\n            pg = PaymentGatewayPage(page_with_screenshot)\n            pg_response = PaymentGatewayResponsePage(page_with_screenshot)\n    \n            # Fill and verify client and payer details\n            fill_and_verify_client_details(self.logger, client, client_details, excel_client_code, excel_environment)\n            fill_payer_details(\n                logger, client_details, ReadConfig.get_payer_first_name(),\n                ReadConfig.get_payer_last_name(), str(amount), ReadConfig.get_payer_phone(),\n                ReadConfig.get_payer_email()\n            )\n    \n            # Get transaction ID\n            with allure.step(f\"Accessing the Client_txn_id\"):\n                txn_id = client_details.get_value(\"_client_transaction_id\")\n                allure.attach(txn_id, name=f\"Client Transaction ID for {excel_client_code}\",\n                              attachment_type=allure.attachment_type.TEXT)\n    \n            # Click Pay button\n            with allure.step(\"Clicking Pay Button\"):\n                logger.info(\"Clicking Pay button\")\n                client_details.click(\"_pay_btn\")\n    \n            time.sleep(5)\n    \n            # Handle payment mode and get amounts\n            bill_amount, conv_charges, total_amount = self._handle_payment_mode(pg, payment_mode, logger)\n    \n    \n            #time.sleep(10)\n    \n            # Handle failure for specific scenario and slab\n            # if scenario in [\"S8\", \"S13\", \"S16\", \"S24\", \"S21\"] and slab == \"5001-10000\":\n            #     status = \"Fail\"\n            #     with allure.step(\"transaction is aborted for scenario and slab\"):\n            #         allure.attach(\n            #             f\"Scenario={scenario}, Slab={slab} is restricted → marking as Fail\",\n            #             name=\"Failure\",\n            #             attachment_type=allure.attachment_type.TEXT\n            #         )\n            #     pytest.fail(f\"Scenario={scenario}, Slab={slab} →  test as failed \")\n    \n            # \uD83D\uDD39 Call the Payment Aborted check here\n>           status = self._check_payment_aborted(page_with_screenshot)\n\ntestCases\\eNach_test.py:193: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <testCases.eNach_test.TestCalculations object at 0x0000021BDD4FA2E0>, page = <Page url='https://securetest.sabpaisa.in/ClientTest/callBackV1Prod'>\n\n    def _check_payment_aborted(self, page):\n        \"\"\"Helper to check if Payment Aborted message appears.\"\"\"\n        locator = page.locator(\"//h1[normalize-space()='Payment Aborted']\")\n        try:\n            locator.wait_for(state=\"visible\", timeout=10000)\n            with allure.step(\"Payment Aborted message appeared → Test Failed\"):\n                allure.attach(\"Payment Aborted element found\",\n                              name=\"Failure Reason\",\n                              attachment_type=allure.attachment_type.TEXT)\n>           pytest.fail(\"Payment Aborted message found on screen\")\nE           Failed: Payment Aborted message found on screen\n\ntestCases\\eNach_test.py:111: Failed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"attach_test_timestamp","time":{"start":1760584036052,"stop":1760584036056,"duration":4},"status":"passed","steps":[],"attachments":[{"uid":"48720be006053626","name":"Test Execution Timestamp","source":"48720be006053626.txt","type":"text/plain","size":19}],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":1,"hasContent":true,"attachmentStep":false,"stepsCount":0},{"name":"browser","time":{"start":1760584036056,"stop":1760584038099,"duration":2043},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"page","time":{"start":1760584038099,"stop":1760584041604,"duration":3505},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"page_with_screenshot","time":{"start":1760584041604,"stop":1760584041604,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"ensure_db_updated","time":{"start":1760584041605,"stop":1760584041609,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0}],"testStage":{"status":"failed","statusMessage":"Failed: Payment Aborted message found on screen","statusTrace":"self = <testCases.eNach_test.TestCalculations object at 0x0000021BDD4FA2E0>, page_with_screenshot = <Page url='https://securetest.sabpaisa.in/ClientTest/callBackV1Prod'>\nscenario = 'S24', payment_mode = 'UPI INTENT', slab = '1-1000', amount = 800, excel_client_code = 'DJ050', excel_environment = 'STAGING', ensure_db_updated = None\n\n    @allure.story(\"e-Nach Calculation\")\n    @allure.severity(allure.severity_level.CRITICAL)\n    @pytest.mark.ui\n    @pytest.mark.regression\n    def test_calculation_amount(self, page_with_screenshot, scenario, payment_mode, slab, amount, excel_client_code,\n                                excel_environment, ensure_db_updated):\n        logger = LogGen.loggen(\"Calculation\")\n        \"\"\"Test the cancel transaction button functionality.\"\"\"\n        timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n        allure.dynamic.title(\n            f\"eNach With out round off Calculation Testing | Scenario={scenario} | Mode={payment_mode} | Slab={slab} | Amount={amount}\"\n        )\n        logger.info(f\"--- Starting calculation Test for {scenario} | {payment_mode} | {slab} | {amount} ---\")\n    \n        bill_amount = conv_charges = total_amount = txn_id = \"N/A\"\n        status = \"Fail\"\n    \n        try:\n            if payment_mode == \"UPI INTENT\":\n                viewport_size = {\"width\": 375, \"height\": 667}  # Example: iPhone-like dimensions\n                page_with_screenshot.set_viewport_size(viewport_size)\n                logger.info(\n                    f\"Set viewport size to {viewport_size['width']}x{viewport_size['height']} for UPI INTENT mode\")\n                allure.attach(page_with_screenshot.screenshot(), name=\"UPI Intent Initial Viewport\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n    \n            # Initialize page objects\n            client = ClientPage(page_with_screenshot)\n            client_details = ClientDetailsPage(page_with_screenshot)\n            pg = PaymentGatewayPage(page_with_screenshot)\n            pg_response = PaymentGatewayResponsePage(page_with_screenshot)\n    \n            # Fill and verify client and payer details\n            fill_and_verify_client_details(self.logger, client, client_details, excel_client_code, excel_environment)\n            fill_payer_details(\n                logger, client_details, ReadConfig.get_payer_first_name(),\n                ReadConfig.get_payer_last_name(), str(amount), ReadConfig.get_payer_phone(),\n                ReadConfig.get_payer_email()\n            )\n    \n            # Get transaction ID\n            with allure.step(f\"Accessing the Client_txn_id\"):\n                txn_id = client_details.get_value(\"_client_transaction_id\")\n                allure.attach(txn_id, name=f\"Client Transaction ID for {excel_client_code}\",\n                              attachment_type=allure.attachment_type.TEXT)\n    \n            # Click Pay button\n            with allure.step(\"Clicking Pay Button\"):\n                logger.info(\"Clicking Pay button\")\n                client_details.click(\"_pay_btn\")\n    \n            time.sleep(5)\n    \n            # Handle payment mode and get amounts\n            bill_amount, conv_charges, total_amount = self._handle_payment_mode(pg, payment_mode, logger)\n    \n    \n            #time.sleep(10)\n    \n            # Handle failure for specific scenario and slab\n            # if scenario in [\"S8\", \"S13\", \"S16\", \"S24\", \"S21\"] and slab == \"5001-10000\":\n            #     status = \"Fail\"\n            #     with allure.step(\"transaction is aborted for scenario and slab\"):\n            #         allure.attach(\n            #             f\"Scenario={scenario}, Slab={slab} is restricted → marking as Fail\",\n            #             name=\"Failure\",\n            #             attachment_type=allure.attachment_type.TEXT\n            #         )\n            #     pytest.fail(f\"Scenario={scenario}, Slab={slab} →  test as failed \")\n    \n            # \uD83D\uDD39 Call the Payment Aborted check here\n>           status = self._check_payment_aborted(page_with_screenshot)\n\ntestCases\\eNach_test.py:193: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <testCases.eNach_test.TestCalculations object at 0x0000021BDD4FA2E0>, page = <Page url='https://securetest.sabpaisa.in/ClientTest/callBackV1Prod'>\n\n    def _check_payment_aborted(self, page):\n        \"\"\"Helper to check if Payment Aborted message appears.\"\"\"\n        locator = page.locator(\"//h1[normalize-space()='Payment Aborted']\")\n        try:\n            locator.wait_for(state=\"visible\", timeout=10000)\n            with allure.step(\"Payment Aborted message appeared → Test Failed\"):\n                allure.attach(\"Payment Aborted element found\",\n                              name=\"Failure Reason\",\n                              attachment_type=allure.attachment_type.TEXT)\n>           pytest.fail(\"Payment Aborted message found on screen\")\nE           Failed: Payment Aborted message found on screen\n\ntestCases\\eNach_test.py:111: Failed","steps":[{"name":"Filling and verifying client details","time":{"start":1760584041769,"stop":1760584042628,"duration":859},"status":"passed","steps":[{"name":"Filling Client Code : DJ050","time":{"start":1760584041769,"stop":1760584041852,"duration":83},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"Selecting Environment : STAGING","time":{"start":1760584041852,"stop":1760584041904,"duration":52},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"Clicking Show Detail","time":{"start":1760584041904,"stop":1760584042543,"duration":639},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"Verifying if Payer Name is visible","time":{"start":1760584042543,"stop":1760584042628,"duration":85},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0}],"attachments":[],"parameters":[{"name":"logger","value":"<RootLogger root (DEBUG)>"},{"name":"client","value":"<pageObjects.client_page.ClientPage object at 0x0000021BDD9DBCB0>"},{"name":"client_details","value":"<pageObjects.client_details_page.ClientDetailsPage object at 0x0000021BDD962490>"},{"name":"client_code","value":"'DJ050'"},{"name":"environment","value":"'STAGING'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"attachmentStep":false,"stepsCount":4},{"name":"Filling payer details","time":{"start":1760584042629,"stop":1760584042895,"duration":266},"status":"passed","steps":[],"attachments":[],"parameters":[{"name":"logger","value":"<RootLogger root (DEBUG)>"},{"name":"client_details","value":"<pageObjects.client_details_page.ClientDetailsPage object at 0x0000021BDD962490>"},{"name":"firstname","value":"'Bhargava'"},{"name":"lastname","value":"'Battina'"},{"name":"amount","value":"'800'"},{"name":"mobilenumber","value":"'1234567890'"},{"name":"email","value":"'test@sabpaisa.in'"}],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":true,"attachmentStep":false,"stepsCount":0},{"name":"Accessing the Client_txn_id","time":{"start":1760584042895,"stop":1760584042937,"duration":42},"status":"passed","steps":[],"attachments":[{"uid":"8b2f91dbecb55a8e","name":"Client Transaction ID for DJ050","source":"8b2f91dbecb55a8e.txt","type":"text/plain","size":21}],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":1,"hasContent":true,"attachmentStep":false,"stepsCount":0},{"name":"Clicking Pay Button","time":{"start":1760584042937,"stop":1760584043241,"duration":304},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"Payment Aborted message appeared → Test Failed","time":{"start":1760584064813,"stop":1760584064819,"duration":6},"status":"passed","steps":[],"attachments":[{"uid":"b1305b1a97a209ef","name":"Failure Reason","source":"b1305b1a97a209ef.txt","type":"text/plain","size":29}],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":1,"hasContent":true,"attachmentStep":false,"stepsCount":0}],"attachments":[{"uid":"dbaeb14cf0a98d77","name":"UPI Intent Initial Viewport","source":"dbaeb14cf0a98d77.png","type":"image/png","size":31915},{"uid":"7ef8d1ab53dff354","name":"log","source":"7ef8d1ab53dff354.txt","type":"text/plain","size":77}],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":4,"hasContent":true,"attachmentStep":false,"stepsCount":9},"afterStages":[{"name":"ensure_db_updated::0","time":{"start":1760584065209,"stop":1760584065209,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"page_with_screenshot::0","time":{"start":1760584065294,"stop":1760584070686,"duration":5392},"status":"passed","steps":[],"attachments":[{"uid":"f142f2b97158e211","name":"Screenshot","source":"f142f2b97158e211.png","type":"image/png","size":140272},{"uid":"915c7e75942aa388","name":"Test Video","source":"915c7e75942aa388.webm","type":"video/webm","size":626343}],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":2,"hasContent":true,"attachmentStep":false,"stepsCount":0},{"name":"page::0","time":{"start":1760584070691,"stop":1760584070691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0},{"name":"browser::0","time":{"start":1760584070694,"stop":1760584070716,"duration":22},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"stepsCount":0}],"labels":[{"name":"story","value":"e-Nach Calculation"},{"name":"severity","value":"critical"},{"name":"epic","value":"Payment Gateway"},{"name":"tag","value":"regression"},{"name":"tag","value":"ui"},{"name":"parentSuite","value":"testCases"},{"name":"suite","value":"eNach_test"},{"name":"subSuite","value":"TestCalculations"},{"name":"host","value":"SRS-CL-009"},{"name":"thread","value":"51600-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testCases.eNach_test"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"amount","value":"800"},{"name":"excel_client_code","value":"'DJ050'"},{"name":"excel_environment","value":"'STAGING'"},{"name":"payment_mode","value":"'UPI INTENT'"},{"name":"scenario","value":"'S24'"},{"name":"slab","value":"'1-1000'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[{"uid":"aa7395b5943f39a1","status":"passed","time":{"start":1760583023180,"stop":1760583040470,"duration":17290}}],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":["ui","regression"]},"source":"15272e96101601ae.json","parameterValues":["800","'DJ050'","'STAGING'","'UPI INTENT'","'S24'","'1-1000'"]}